<?xml version="1.0"?>
<mx:TitleWindow
        showCloseButton="true"
        xmlns:mx="http://www.adobe.com/2006/mxml"
        title="Viewing Submitted Expense Report"
        close="{close()}"
        width="800"
        height="600"
        layout="vertical"

        >
    <mx:Script><![CDATA[
        import com.neosavvy.user.dto.project.ExpenseItem;
        import com.neosavvy.user.dto.project.ExpenseReport;
        import com.neosavvy.user.view.secured.expenses.approving.event.ExpenseReportApproveEvent;

        import mx.collections.ListCollectionView;
        import mx.managers.PopUpManager;

        private function close():void {
            PopUpManager.removePopUp(this);
        }

        private function confirmApprove():void {

            dispatchEvent(new ExpenseReportApproveEvent(
                    ExpenseReportApproveEvent.ACTION_APPROVE_CONFIRM
                    , _expenseReport
                    , commentText.text
            ))

            close();
        }

        private function confirmDecline():void {

            dispatchEvent(new ExpenseReportApproveEvent(
                    ExpenseReportApproveEvent.ACTION_DECLINE_CONFIRM
                    , _expenseReport
                    , commentText.text
            ))

            close();
        }

        private var _expenseReport:ExpenseReport

        private var _expenseReportItems:ListCollectionView;

        public function get expenseReport():ExpenseReport {
            return _expenseReport;
        }

        public function set expenseReport(value:ExpenseReport):void {
            _expenseReport = value;

            projectNameLabel.text = _expenseReport.project.name;
            locationLabel.text = _expenseReport.location;
            purposeLabel.text = _expenseReport.purpose;
        }

        public function get expenseReportItems():ListCollectionView {
            return _expenseReportItems;
        }

        public function set expenseReportItems(value:ListCollectionView):void {
            _expenseReportItems = value;

            expenseReportGrid.dataProvider = value;
        }

        private function projectTypeLabelFunction(data:Object, column:AdvancedDataGridColumn):String {
            if (data is ExpenseItem && (data as ExpenseItem).projectType) {
                return (data as ExpenseItem).projectType.type;
            }
            return null;
        }

        private function paymentMethodLabelFunction(data:Object, column:AdvancedDataGridColumn):String {
            if (data is ExpenseItem && (data as ExpenseItem).paymentMethod) {
                return (data as ExpenseItem).paymentMethod.name;
            }
            return null;
        }

        private function expenseTypeLabelFunction(data:Object, column:AdvancedDataGridColumn):String {
            if (data is ExpenseItem && (data as ExpenseItem).expenseItemType) {
                return (data as ExpenseItem).expenseItemType.name;
            }
            return null;
        }
        ]]></mx:Script>

    <mx:Form id="expenseReportSummaryForm" width="100%">
        <mx:FormItem id="projectFormItem" label="Project:">
            <mx:Label id="projectNameLabel"/>
        </mx:FormItem>
        <mx:FormItem id="purposeFormItem" label="Purpose:">
            <mx:Label id="purposeLabel"/>
        </mx:FormItem>
        <mx:FormItem id="locationFormItem" label="Location:">
            <mx:Label id="locationLabel"/>
        </mx:FormItem>
    </mx:Form>

    <mx:AdvancedDataGrid id="expenseReportGrid" width="100%" height="100%">
        <mx:columns>
            <mx:AdvancedDataGridColumn
                    id="dateColumn"
                    headerText="Date"
                    dataField="expenseDate"
                    />
            <mx:AdvancedDataGridColumn
                    id="expenseTypeColumn"
                    headerText="Expense Type"
                    dataField="expenseItemType"
                    labelFunction="{expenseTypeLabelFunction}"
                    />
            <mx:AdvancedDataGridColumn
                    id="paymentMethodColumn"
                    headerText="Payment Method"
                    dataField="paymentMethod"
                    labelFunction="{paymentMethodLabelFunction}"
                    />
            <mx:AdvancedDataGridColumn
                    id="projectTypeColumn"
                    headerText="Project Type"
                    dataField="projectType"
                    labelFunction="{projectTypeLabelFunction}"
                    />
            <mx:AdvancedDataGridColumn
                    id="amountColumn"
                    headerText="Amount"
                    dataField="amountNumber"
                    />

        </mx:columns>
    </mx:AdvancedDataGrid>

    <mx:Label text="Approve/Decline Comment:"/>
    <mx:TextArea id="commentText" width="100%" height="150"/>

    <mx:ControlBar>
        <mx:Button label="Approve" click="confirmApprove()"/>
        <mx:Spacer width="100%"/>
        <mx:Button label="Decline" click="confirmDecline()"/>
    </mx:ControlBar>
</mx:TitleWindow>
